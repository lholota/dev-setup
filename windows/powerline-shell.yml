- name: "Download Powerline fonts"
  win_get_url:
    url: https://github.com/powerline/fonts/archive/master.zip
    dest: "%TEMP%\\PowerlineFonts.zip"
    
- name: "Extract Powerline fonts"
  win_unzip:
    src: "%TEMP%\\PowerlineFonts.zip"
    dest: "%TEMP%"

- name: "Find font files"
  register: powerline_fonts
  win_find:
    paths: 
      - "{{ ansible_env.TEMP }}\\fonts-master"
    patterns: [ '*.otf', '*.ttf' ]
    recurse: yes

- name: "Copy fonts"
  # win_copy:
  #   src: "{{ item.path }}"
  #   dest: "%SYSTEMROOT%\\fonts\\"
  #   msg: 
  debug:
    msg: "{{ item.path | win_basename }}"
  loop: "{{ powerline_fonts.files }}"


# - name: "Import Powerline fonts"
#   ansible.windows.win_command: "powershell -"
#   args:
#     stdin: "Set-ExecutionPolicy ByPass -Scope Process -Force; .\\install.ps1"
#     chdir: "%TEMP%\\fonts-master"

# - name: "Find Windows Terminal AppData directory"
#   ansible.windows.win_find:
#     paths: "%LOCALAPPDATA%\\Packages"
#     patterns: [ 'Microsoft.WindowsTerminal_*' ]
#     file_type: directory
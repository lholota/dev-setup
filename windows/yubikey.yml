- name: Install GPG4Win
  win_chocolatey:
    name: gpg4win
    version: 3.1.14
    state: present

- name: Enable Putty support
  win_lineinfile:
    path: '%APPDATA%\gnupg\gpg-agent.conf'
    create: yes
    regex: '(^enable-putty-support)'
    line: 'enable-putty-support'
    newline: windows

- name: Enable SSH support
  win_lineinfile:
    path: '%APPDATA%\gnupg\gpg-agent.conf'
    create: yes
    regex: '(^enable-ssh-support)'
    line: 'enable-ssh-support'
    newline: windows

- name: Configure gpg-agent to start on Windows startup
  win_shortcut:
    src: 'C:\Program Files (x86)\GnuPG\bin\gpg-connect-agent.exe'
    arguments: '/bye'
    dest: '%APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup\GPG-Agent.lnk'